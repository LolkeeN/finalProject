<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">


    <!--    <changeSet  id="drop_user_table"  author="Vasyl Veselov">-->
    <!--        <preConditions  onFail="WARN">-->
    <!--            <sqlCheck  expectedResult="0">select count(*) from users</sqlCheck>-->
    <!--        </preConditions>-->
    <!--        <comment>Comments should go after preCondition. If they are located before the precondition, then Liquibase usually gives error.</comment>-->
    <!--        <dropTable  tableName="users"/>-->
    <!--    </changeSet>-->

    <changeSet id="create_user_table" author="Vasyl Veselov">
        <createTable tableName="users">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="first_name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="role" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="create_meeting_table" author="Vasyl Veselov">
        <createTable tableName="meeting">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="date" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <!--            <column name="topic_id" type="varchar(255)">-->
            <!--                <constraints nullable="false"/>-->
            <!--            </column>-->
            <column name="language" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="create_topic_table" author="Vasyl Veselov">
        <createTable tableName="topic">
            <column name="id" type="INT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="date" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
            <column name="language" type="varchar(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>


    <changeSet author="Vasyl Veselov" id="fill_meeting_table">
        <insert tableName="meeting">
            <column name="name" value="gagagag"/>
            <column name="date" value="01.06.2021"/>
            <column name="language" value="EN"/>
        </insert>
    </changeSet>

    <changeSet author="Vasyl Veselov" id="fill_topic_table">
        <insert tableName="topic">
            <column name="name" value="tatatata"/>
            <column name="date" value="01.06.2021"/>
            <column name="language" value="EN"/>
        </insert>
    </changeSet>

    <changeSet author="Vasyl Veselov" id="fill_users_table">
        <insert tableName="users">
            <column name="email" value="email@gmail.com"/>
            <column name="password" value="parol"/>
            <column name="role" value="1"/>
            <column name="first_name" value="Denys"/>
            <column name="last_name" value="Petrov"/>
        </insert>
    </changeSet>


    <changeSet id="create_meeting_topic_table" author="Vasyl Veselov">
        <createTable tableName="meeting_topic">
            <column name="meeting_id" type="INT">
                <constraints foreignKeyName="meeting_id" nullable="false" references="meeting(id)"/>
            </column>
            <column name="topic_id" type="INT">
                <constraints foreignKeyName="topic_id" nullable="false" references="topic(id)"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="create_registered_users_table" author="Vasyl Veselov">
        <createTable tableName="registered_users">
            <column name="meeting_id" type="INT">
                <constraints foreignKeyName="fk_meeting_id" nullable="false" references="meeting(id)"/>
            </column>
            <column name="user_id" type="INT">
                <constraints foreignKeyName="user_id" nullable="false" references="users(id)"/>
            </column>
        </createTable>
    </changeSet>


</databaseChangeLog>

